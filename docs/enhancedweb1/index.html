<!doctype html>
<html class="docs-version-current" lang="zh-CN" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="icodex RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="icodex Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-153188913-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-153188913-1",{anonymize_ip:!0})</script>
<link rel="search" type="application/opensearchdescription+xml" title="icodex" href="/opensearch.xml">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><title data-react-helmet="true">从 URL 解析到 Web 展示 | icodex</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://icodex.me/docs/enhancedweb1"><meta data-react-helmet="true" name="docsearch:language" content="zh-CN"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" name="keywords" content="frontend, react, javascript, css, react, vue, typescript, docusaurus, blog, personal blog, personal website"><meta data-react-helmet="true" property="og:title" content="从 URL 解析到 Web 展示 | icodex"><meta data-react-helmet="true" name="description" content="浏览器的工作进程"><meta data-react-helmet="true" property="og:description" content="浏览器的工作进程"><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://icodex.me/docs/enhancedweb1"><link data-react-helmet="true" rel="alternate" href="https://icodex.me/docs/enhancedweb1" hreflang="zh-CN"><link data-react-helmet="true" rel="alternate" href="https://icodex.me/docs/enhancedweb1" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://GMKEEJO8X4-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.83facce5.css">
<link rel="preload" href="/assets/js/runtime~main.8c421c00.js" as="script">
<link rel="preload" href="/assets/js/main.77349e7c.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_RReh"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="icodex" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/logo.png" alt="icodex" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">icodex</b></a></div><div class="navbar__items navbar__items--right"><div class="searchBox_Utm0"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div><a class="navbar__item navbar__link" href="/pages/project">My Project</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">Skill</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/javascript/类型/类型定义">JavaScript</a></li><li><a class="dropdown__link" href="/docs/css/CSS代码规范">CSS</a></li><li><a class="dropdown__link" href="/docs/typescript/tsconfig">TypeScript</a></li><li><a class="dropdown__link" href="/docs/react/hooks/常用hooks">React</a></li><li><a class="dropdown__link" href="/docs/nodejs/awesome-nodejs">NodeJS</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">Learn</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/network/网速与带宽">Network</a></li><li><a class="dropdown__link" href="/docs/algorithm/算法分析">Algorithm</a></li></ul></div><a class="navbar__item navbar__link navbar__link--active" href="/docs/engineer/">Engineer</a><a class="navbar__item navbar__link" href="/docs/tools/git">Tool</a><a href="https://github.com/wood3n/icodex-next" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">🌜</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">🌞</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0 sidebarWithHideableNavbar_VlPv"><a tabindex="-1" class="sidebarLogo_hmkv" href="/"><img src="/img/logo.png" alt="icodex" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/logo.png" alt="icodex" class="themedImage_TMUO themedImage--dark_uzRr"><b>icodex</b></a><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/engineer/ESLint">ESLint的使用</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/engineer/git hooks">git hooks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/engineer/">前端工程化</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/engineer/跨域解决方式">跨域与解决方案</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/engineer/Babel/babel plugin编写">Babel</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/engineer/vscode插件开发/vsex1">vscode插件开发</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/webpack5">webpack5配置</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/engineer/webpack优化/webpack优化（1）">webpack优化</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/webpackloader">webpack原理</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" href="/docs/enhancedweb1">web性能优化</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/enhancedweb1">从 URL 解析到 Web 展示</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/enhancedweb2">web性能优化（2）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/engineer/web性能优化/web性能指标">web 性能指标</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/engineer/使用yeoman搭建脚手架/脚手架搭建（1）">使用yeoman搭建脚手架</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/engineer/基于webpack搭建react项目/搭建React项目（1）">基于webpack搭建react项目</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/engineer/模块语法/CSS模块语法">模块语法</a></div></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>从 URL 解析到 Web 展示</h1></header><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="浏览器的工作进程">浏览器的工作进程<a class="hash-link" href="#浏览器的工作进程" title="Direct link to heading">​</a></h2><p>在熟悉 URL 到 web 展示之前，首先需要了解浏览器的软件架构。以目前市场占有率最高的 Chrome 浏览器为例，Chrome 主要基于开源的 Chromium 项目包装了 UI 等程序。</p><table><thead><tr><th>Compare</th><th>Chrome</th><th>Chromium</th></tr></thead><tbody><tr><td>是否开源</td><td>闭源</td><td>以 BSD 许可协议开源</td></tr><tr><td>隐私性</td><td>会自动收集信息并将其传输给 Google，例如崩溃报告，使用情况统计信息，设备操作系统等</td><td>不会自动收集浏览器的崩溃信息，也不会收集用户信息</td></tr><tr><td>稳定性</td><td>更胜一筹</td><td></td></tr><tr><td>更新机制</td><td>会自动下载并安装更新</td><td>需要手动下载和安装补丁</td></tr><tr><td>拓展</td><td>除了基本的免费编解码器：Opus，Theora，Vorbis，VP8，VP9 和 WAV，还集成了 flash，支持播放 H.264 编码的视频，支持专有媒体格式 AAC，H.264 和 MP3 的许可编解码器</td><td>只支持基本免费编解码器：Opus，Theora，Vorbis，VP8，VP9 和 WAV</td></tr></tbody></table><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="chromium-的多进程架构">Chromium 的多进程架构<a class="hash-link" href="#chromium-的多进程架构" title="Direct link to heading">​</a></h3><blockquote><p><a href="https://www.chromium.org/developers/design-documents/multi-process-architecture" target="_blank" rel="noopener noreferrer">Multi-process Architecture</a></p></blockquote><p>Chromium 采用的是多进程架构，在启动的时候就会开启多个进程来完成页面的渲染和其它一些任务。</p><table><thead><tr><th>进程</th><th>说明</th></tr></thead><tbody><tr><td>浏览器主进程</td><td>浏览器的主进程包括 UI 线程，例如地址栏，书签栏，前进后退按钮等；<br>负责用户交互；<br>负责管理其他子进程；<br>同时还包含提供存储功能的存储线程</td></tr><tr><td>Network Service 网络进程</td><td>负责网络请求，例如页面资源文件 HTML，JS，CSS 的加载；网络进程本来是浏览器主进程的一个线程，但是后来独立成为一个进程</td></tr><tr><td>渲染进程</td><td>渲染进程主要负责浏览器的每一个标签页里面内容呈现，Chrome 的 Blink 引擎和 V8 引擎都是工作在这个进程的，Blink 负责解析 HTML 和 CSS 以及页面渲染等；V8 负责执行 JS</td></tr><tr><td>GPU 进程</td><td>GPU 的使用初衷是为了实现 3D CSS 的效果，随后 Chrome 也使用 GPU 来绘制浏览器的 UI 框架</td></tr><tr><td>多个插件进程</td><td>每个插件都是独立运行在单独的进程中</td></tr><tr><td>V8 代理解析工具</td><td>解析 PAC，PAC 是一种网页浏览器技术，用于定义浏览器该如何自动选择适当的代理服务器来访问一个网址，也就是翻墙</td></tr></tbody></table><p><img alt="image-20200806210501832" src="/assets/images/image-20200806210501832-2a77530a8ced4cfa334e11ff4b8e5620.png"></p><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="不同的渲染进程模式">不同的渲染进程模式<a class="hash-link" href="#不同的渲染进程模式" title="Direct link to heading">​</a></h3><p>实际上 Chromium 在渲染页面的时候支持使用不同的进程模型来开启渲染进程，默认情况下 Chromium 对用户访问的网站的每个实例使用单独的 OS 进程（也就是一个标签页就是一个进程）；但是用户仍然可以指定命令行开关选择其它模型。</p><blockquote><p><a href="https://www.chromium.org/developers/design-documents/process-models" target="_blank" rel="noopener noreferrer">Process Models</a></p></blockquote><ul><li><code>site</code>：Chrome 定义<code>site</code>的方式是协议<code>scheme</code>和主机名称<code>hostname</code>，并且包含子域名和端口号，例如 mail.google.com 和 docs.google.com，或者 google.com 和 google.com:8080 都属于相同的<code>site</code>；这是为了不同子域名的页面或站点端口不同的页面能够通过 Javascript 相互访问；</li><li>Process-per-site-instance：默认情况下 Chrome 会为<code>site</code>的每一个实例开启一个进程，也就是打开一个链接地址就开启一个进程，这种方式的好处是隔离不同站点也隔离了同一站点的不同页面，即使是同一个站点的内容，如果在一个页面中填写表单崩溃，也不会影响到同站点的另一个页面；但是这种方式也带来更高操作系统内存占用；</li><li>Process-per-site：同一个<code>site</code>的所有实例都放到一个渲染进程中；</li><li>Process-per-tab：每一个选项卡是一个单独的渲染进程；</li><li>Single process：更简单了，就一个渲染进程搞定所有页面。</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="多进程架构的优劣">多进程架构的优劣<a class="hash-link" href="#多进程架构的优劣" title="Direct link to heading">​</a></h3><ul><li>最重要的两点是多进程保证网页访问的稳定性和安全性，即使是同一个网站，当开启不同页面时，使用多进程的方式为每个页面单独打开一个进程，也能保证足够的页面稳定性！不仅如此，页面的 JS 文件，浏览器插件等也很容易让页面发生崩溃，如果将插件和每个页面都单独放置在一个进程内，由于进程之间相互独立，即使一个进程崩溃也不会影响其他进程运行，并且进程之间无法直接通信，这样既保证稳定性又保证安全性；</li><li>从开发角度看，多进程之间通信比较困难；从用户角度看，多进程模式很容易造成操作系统内存占用提高</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="从-url-解析到-web-展示">从 URL 解析到 Web 展示<a class="hash-link" href="#从-url-解析到-web-展示" title="Direct link to heading">​</a></h2><p>​		从 URL 到 web 页面显示这之间的过程不是一句两句能概括的，但是从前端能感知的角度出发，可以把过程大致概括为以下 9 个阶段：</p><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="构建-url">构建 URL<a class="hash-link" href="#构建-url" title="Direct link to heading">​</a></h3><p>当用户在地址栏键入 URL 时，UI 线程会判断这是一个网络地址还是搜索查询的内容，</p><ul><li>如果是搜索内容，UI 线程会根据浏览器的默认搜索引擎合成搜索 URL；</li><li>如果是一个域名，UI 线程会判断是否要为域名添加协议等内容组成一个完整的 URL；</li></ul><p>之后，UI 线程会把 URL 提交给网络进程进行处理。</p><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="查找缓存">查找缓存<a class="hash-link" href="#查找缓存" title="Direct link to heading">​</a></h3><p>网络进程在收到 URL 请求以后，会查找资源缓存。现代浏览器内部都内建了私有缓存，根据 HTTP 缓存策略去选择是否将 web 资源暂时保存在内存中，或者持久化到电脑磁盘文件中。浏览器内部的缓存机制有以下几种：</p><ul><li>内存缓存：内存缓存保存了 web 页面整个生命周期阶段中从网络请求获取到的资源，同时针对指定了<code>preload</code>属性的资源，也会提前请求并缓存在内存中；</li><li><code>Service Worker</code>缓存：Service Worker 本身带有缓存相关的方法，主要是为了离线 web 网页而使用，web 开发者可以指定缓存的内容，具体的参考 —— <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Service_Worker_API/Using_Service_Workers" target="_blank" rel="noopener noreferrer">使用 Service Workers - Web API 接口参考 | MDN (mozilla.org)</a></li><li>磁盘缓存：磁盘缓存通常用于缓存较大体积文件，此时受制于电脑内存容量，已无法使用内存缓存。</li><li><code>Push Cache</code>：作为 HTTP2 Session 的一部分，存留时间大概 5 分钟（Chrome）。</li></ul><p>查找到缓存以后，如果是使用 HTTP1.0 版本的服务器返回的资源，那么只需要根据资源头部使用的<code>Expires:&lt;Date&gt;</code>和<code>Pragma</code>来确定是否使用缓存。而使用 HTTP1.1+ 版本的服务器，支持在 HTTP 响应首部使用<code>Cache-control</code>控制资源缓存策略。</p><p>如果可以利用缓存，则浏览器会直接将缓存作为响应返回，不支持的话，就需要开启额外的 TCP 连接去和服务端请求资源。</p><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="dns解析">DNS解析<a class="hash-link" href="#dns解析" title="Direct link to heading">​</a></h3><p>DNS（Domain Name Server），域名解析服务器，一般是互联网服务提供商（ISP）或者第三方组织（google）提供的一个公共的服务器资源，用于将域名和对应的 IP 地址映射关系保存起来，并响应客户端请求返回域名对应的 IP 地址。</p><p>DNS 查询的记录可以被浏览器或者计算机缓存，例如 chrome 内部可以使用<code>chrome://net-internals/#dns</code>查看缓存的 DNS 记录，而计算机内置的 DNS 客户端也可以缓存查询记录。如果没有缓存，则 DNS 查询请求就会被转发到 ISP 指定的 DNS 服务器或者第三方 DNS 服务器，由它们内部的 DNS 解析器开启 DNS 解析过程。</p><p>DNS 解析采用递归解析的方式来返回域名对应的 IP 地址，并且使用网络运输层 UDP 协议建立连接，因为 UDP 协议不需要建立连接即可发送请求，所以过程非常迅速，例如查询<code>example.com</code>的过程如下：</p><ol><li>DNS 解析器查询根域名服务器，获取顶级域名（<code>.com</code>）服务器的 IP 地址；</li><li>继续向顶级域名服务器发送请求，获取到权威域名<code>example.com</code>对应的 IP 地址；</li><li>此时 DNS 解析器就可以将 IP 地址返回给本地计算机，这样浏览器就可以获取域名对应的 IP 地址；而如果还有三级域名这种的结构<code>xxx.example.com</code>，则还需要向权威域名发送查询请求，权威域名会返回附加域名的 IP 地址</li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="建立-tcp-连接">建立 TCP 连接<a class="hash-link" href="#建立-tcp-连接" title="Direct link to heading">​</a></h3><p>获取到域名对应的 IP 地址以后，浏览器就可以像目标 IP 地址建立 TCP 连接，TCP 连接建立的过程不用多说 —— 三次握手，更准确来说应该是一次握手，三报文交换。</p><p><img alt="img" src="/assets/images/TCP-connection-1-808756a8c4d1dd54c278dd8dacede423.png"></p><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="发送-http-请求并接收响应">发送 HTTP 请求并接收响应<a class="hash-link" href="#发送-http-请求并接收响应" title="Direct link to heading">​</a></h3><p>紧接上文缓存机制说起，根据 HTTP 缓存策略，浏览器需要对以下几种类型的缓存发送再验证请求，再验证一般使用 GET 方法向服务器发送请求确认缓存资源可以使用，如果缓存有效，服务端返回 HTTP 响应状态码<code>304</code>，而如果缓存失效，则服务端会返回新的资源和<code>200</code>状态响应。</p><ol><li><code>Pragma: no-cache</code>：用于 HTTP1.0 时代；缓存资源必须进行验证</li><li><code>Cache-control: no-cache</code>：对缓存的资源每次都必须进行验证</li><li><code>Cache-control: must-revalidate</code>：对过期的缓存资源必须进行验证</li></ol><p>当网络进程收到服务器发来的 HTTP 报文时，会首先判断响应状态码，如果是<code>301</code>，<code>302</code>，<code>307</code>之类的重定向响应，网络进程还会根据响应头部的<code>Location</code>字段再次发起重定向请求新的 URL。</p><p>如果是<code>200</code>之类表示请求成功的响应，则会根据 HTTP 响应首部字段的<code>Content-Type</code>字段区分数据的类型，不同类型的数据需要不同的解析程序。例如 HTML 需要提交渲染进程进行 DOM 解析，而<code>application/octet-stream</code>之类的下载资源文件，网络进程就会提交下载请求到浏览器的下载管理器进行下载。</p><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="dom-解析">DOM 解析<a class="hash-link" href="#dom-解析" title="Direct link to heading">​</a></h3><p>当浏览器获取到服务端发送的 HTML 文档以后，就会开启 DOM 解析的过程。DOM 解析的过程是将 HTML 代码字符解析转换成 DOM 对象，也就是编译的几个阶段：</p><ol><li>解码：从 HTTP 返回的报文都是编码过的字节流数据，需要从<code>Content-Type</code>获取编码方式，然后转换成源代码字符；</li><li>词法分析：逐个分析 HTML 代码字符，根据 HTML 的标签语法等特点，将带个字符重新组合成标签元素，得到<code>tokens</code>；</li><li>语法分析：对<code>tokens</code>进行遍历，将它们之间重新建立起 DOM 对象上下文的结构关系，最终组成 DOM 对象</li></ol><p><img alt="image-20220404204135434" src="/assets/images/image-20220404204135434-f1dbba2ccecf4f4e48744b1ae37ff885.png"></p><p>在 DOM 解析的过程中，对于 CSS 和 JS 资源还需要请求加载才能解析，其中还有一些预加载资源：</p><ul><li><code>&lt;link rel=&quot;preload&quot;&gt;</code>：在<code>link</code>标签内部指定<code>preload</code>属性会让浏览器尽快请求某个资源文件并且缓存下来，这样后续遇到该资源的时候就可以更快加载执行；</li><li><code>&lt;link rel=&quot;prefetch&quot;&gt;</code>：在<code>link</code>标签内部指定<code>prefetch</code>指定浏览器在空闲时间请求某个资源并缓存下来，相比<code>preload</code>适合预加载页面低优先级的一些资源文件；</li><li><code>&lt;script defer&gt;</code>：先请求 JS 文件，等到 HTML 解析完成以后触发 <code>DOMContentLoaded</code> 事件前去执行；</li><li><code>&lt;script async&gt;</code>：先请求 JS 文件，等 JS 请求完就会加载执行</li><li><code>&lt;script type=&quot;module&quot;&gt;</code>对于 ES Modules 模块内部 JS，行为和<code>defer</code>一致</li></ul><p><img alt="image-20220404204343718" src="/assets/images/image-20220404204343718-1cb69d71a1612b7ece3e8c4a5a4a56ba.png"></p><p>在解析 HTML 的过程中，同时还会请求加载 CSS 并解析得到 CSSOM，CSSOM 也是一个树形结构，会把 DOM 元素和 CSS 样式关联起来。</p><p><img alt="image-20220404212352317" src="/assets/images/image-20220404212352317-6de72a53f57b1f10c0c946bd198b5e86.png"></p><p>计算 DOM 节点的样式需要根据 CSS 的继承和层叠规则来进行，一个 DOM 节点的样式可以来源于以下方面：</p><ul><li>元素的 <code>style</code> 属性内嵌的 CSS</li><li>页面<code>&lt;style&gt;</code>内嵌的 CSS</li><li>页面<code>&lt;link&gt;</code>引入的 CSS</li><li>浏览器的用户代理样式</li><li>继承自父节点的样式</li></ul><p>在 JS 中可以使用<code>Window.getComputedStyle(element)</code>这个 API，这个方法返回一个元素的最终计算得到的所有 CSS 属性值。</p><p><img alt="image-20220404214943425" src="/assets/images/image-20220404214943425-0589b86ddbd0473196e8477733dd54fd.png"></p><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="构建-render-树">构建 render 树<a class="hash-link" href="#构建-render-树" title="Direct link to heading">​</a></h3><p>得到 DOM 和 CSSOM 以后，浏览器会将两者组合起来，构建 render 树，主要是以下过程：</p><ul><li>遍历 DOM 节点，筛选页面可见的 DOM 元素，剔除<code>script</code>，<code>meta</code>等元素以及<code>display:none</code>等不可见的元素；</li><li>从 CSSOM 查找适用于当前节点的样式</li><li>返回可见元素节点和样式组合</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="布局">布局<a class="hash-link" href="#布局" title="Direct link to heading">​</a></h3><p>得到 DOM 可见节点和样式以后，还需要计算 DOM 节点的尺寸大小和在视口内的位置坐标，也就是布局过程，也成为回流（<code>reflow</code>）。</p><p>布局过程还需要对节点进行遍历，从父元素开始确定尺寸和位置，然后到子元素一层层进行，相对定位等都会被转换成具体的像素坐标值，最终得到 DOM 节点的盒模型，盒模型能够准确地描述元素的尺寸和在视口内的位置坐标。</p><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="绘制">绘制<a class="hash-link" href="#绘制" title="Direct link to heading">​</a></h3><p>绘制又称为光栅化，是浏览器调用操作系统的绘制 API 根据节点的坐标和尺寸将节点元素绘制在屏幕上。到此，完成 HTML 的渲染流程。</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/wood3n/icodex-next/tree/master/docs/engineer/web性能优化/web性能优化1.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/webpackinner"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">webpack基本原理</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/enhancedweb2"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">web性能优化（2）</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#浏览器的工作进程" class="table-of-contents__link toc-highlight">浏览器的工作进程</a><ul><li><a href="#chromium-的多进程架构" class="table-of-contents__link toc-highlight">Chromium 的多进程架构</a></li><li><a href="#不同的渲染进程模式" class="table-of-contents__link toc-highlight">不同的渲染进程模式</a></li><li><a href="#多进程架构的优劣" class="table-of-contents__link toc-highlight">多进程架构的优劣</a></li></ul></li><li><a href="#从-url-解析到-web-展示" class="table-of-contents__link toc-highlight">从 URL 解析到 Web 展示</a><ul><li><a href="#构建-url" class="table-of-contents__link toc-highlight">构建 URL</a></li><li><a href="#查找缓存" class="table-of-contents__link toc-highlight">查找缓存</a></li><li><a href="#dns解析" class="table-of-contents__link toc-highlight">DNS解析</a></li><li><a href="#建立-tcp-连接" class="table-of-contents__link toc-highlight">建立 TCP 连接</a></li><li><a href="#发送-http-请求并接收响应" class="table-of-contents__link toc-highlight">发送 HTTP 请求并接收响应</a></li><li><a href="#dom-解析" class="table-of-contents__link toc-highlight">DOM 解析</a></li><li><a href="#构建-render-树" class="table-of-contents__link toc-highlight">构建 render 树</a></li><li><a href="#布局" class="table-of-contents__link toc-highlight">布局</a></li><li><a href="#绘制" class="table-of-contents__link toc-highlight">绘制</a></li></ul></li></ul></div></div></div></div></main></div></div></div>
<script src="/assets/js/runtime~main.8c421c00.js"></script>
<script src="/assets/js/main.77349e7c.js"></script>
</body>
</html>